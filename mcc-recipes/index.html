<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <meta property="og:title" content="MCC Recipes"/>
    <meta property="og:site_name" content="MCC Recipes"/>
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://exnonull.github.io/mcc-recipes/" />
    <meta property="og:image" content="https://exnonull.github.io/mcc-recipes/images/recipe.png"/>
    <meta property="og:description" content="Some recipes for Modded Cube Combination."/>

    <title>MCC Recipes</title>
    <link rel="icon" href="../aw-recipes/favicon.png" />
    <link rel="icon" href="../aw-recipes/favicon.png" type="image/png" />
    <link rel="apple-touch-icon" href="../aw-recipes/favicon.png" />
    <style>
      body {
        max-width: 100%;
        max-height: 100%;
        overflow-x: hidden;
        background-color: #212121;
        color: white;
      }

      
      header {
        display: flex;
        justify-items: flex-start;
        align-content: center;
        flex-direction: column;
        flex-wrap: wrap;
      }
      input {
        border: 1px solid transparent;
        outline: none;

        font-size: 18px;
        padding: 5px;
        height: 60px;
        width: 350px;
        margin-top: 60px;

        border-radius: 5px;
        color: black;
      }
      datalist {
        position: absolute;
        background-color: black;
        border: 1px solid white;
        border-radius: 0 0 5px 5px;
        border-top: none;
        font-family: sans-serif;
        width: 350px;
        padding: 5px;
        max-height: 10rem;
        overflow-y: auto
      }
      option {
        background-color: black;
        padding: 4px;
        color: white;
        margin-bottom: 1px;
        font-size: 18px;
        cursor: pointer;
      }
      option:hover, .active{
        background-color: gray;
      }

      main {
        display: flex;
        justify-items: flex-start;
        align-content: center;
        flex-direction: column;
        flex-wrap: wrap;
      }
      .slot {
        word-break: break-word;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        border: solid #4e4e4e 4px;
        background-color: #171717;
        width: 50px;
        height: 50px;
        margin: 12.5px;
        cursor: pointer;
      }
      .slot:hover {
        border: solid #acacac 4px;
        background-color: #4e4e4e;
      }
      .slot.active {
        border: solid #cacaca 4px;
        background-color: #373737;
        border-radius: 8px;
      }
      .slot.special {
        border: solid #538fca 4px;
        background-color: #142637;
        border-radius: 8px;
      }
      .slot.very-special {
        border: solid #27d496 4px;
        background-color: #093b2b;
        border-radius: 8px;
      }
      button {
        border: none;
        border-radius: 16px;
        cursor: pointer;
        width: 100px;
        height: 30px;
      }
      .clear {
        background-color: red;
        color: white;
        height: 17px;
        width: 60px;
      }
      .add {
        background-color: #187e18;
        color: #d1e505;
        margin: 20px 0px;
      }
      .add:hover {
        background-color: #00ff00aa;
      }
      .row {
        display: flex;
        align-items: center;
        justify-content: flex-start;
      }

      .recipes {
        width: 100%;
        height: 100%;
      }

      .recipe {
        display: flex;
        flex-wrap: wrap;
        flex-direction: column;
        align-items: start;
        justify-content: center;
        position: absolute;
        width: 275px;
        height: 275px;
        font-size: 24px;
        text-align: center;

        user-select: none;
        -moz-user-select: none;
        -webkit-user-select: none;
      }

      .recipe > .head {
        cursor: pointer;
        font-size: 36px;

        display: flex;
        justify-content: space-between;
        width: 100%;
        background-color: #000000AA;
      }
      .recipe > .head > .change {
        background-color: green;
        text-align: center;
        width: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .recipe > .head > .change:hover {
        background-color: lightgreen;
      }
      .recipe > .head > .close {
        background-color: red;
        text-align: center;
        width: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .recipe > .head > .close:hover {
        background-color: lightcoral;
      }
      .recipe > .head > .name {
        width: 100%;
        height: 100%;
      }
      .recipe > .head > .name:hover {
        background-color: #cacaca88;
      }
      .recipe > .head > .name > span {
        color: white;
      }
      .recipe > .head > .close > span {
        color: white;
      }

      .recipe > .body {
        width: 100%;
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: start;
        justify-content: start;
        overflow-y: auto;
        background-color: #00000088;
      }
      .recipe > .body > .itemRecipe {
        width: 100%;
        height: 100%;
      }
      .recipeData {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: start;
        align-items: center;
      }
      .recipeData.unknownRecipe {
        display: flex;
        align-items: center;
        justify-content: center;
      }


      .list {
        flex: 1;

        display: flex;
        align-items: flex-start;
        justify-content: flex-start;
        flex-wrap: wrap;
        flex-direction: column;
      }
      .items {
        flex: 1;

        display: flex;
        align-items: flex-start;
        justify-content: flex-start;
        flex-wrap: wrap;
      }
      a {
        cursor: pointer;
      }
      .category {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        flex-wrap: wrap;
      }
      .category > a {
        color: gray;
        border-radius: 16px;
        margin: 5px 10px;
        padding: 5px 10px;
      }
      .category > a.active {
        color: white;
        border-radius: 16px;
        margin: 5px 10px;
        padding: 5px 10px;
      }
      .category > a:hover {
        background-color: #4e4e4e;
      }

      .tooltip {
        position: relative;
        display: inline-block;
      }
      .tooltip .tooltiptext {
        margin-top: 4px;
        visibility: hidden;
        width: 250px;
        background-color: #00000088;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px 0;

        position: absolute;
        z-index: 1;
        white-space: pre-wrap;
      }
      .tooltip:hover .tooltiptext {
        visibility: visible;
      }

      .trello{
        background-color: #6495ed;
        color: white;
        border-radius: 8px;
        height: 45px;
        width: 120px;
        font-size: 18px;
      }
    </style>
  </head>

  <body>
    <header>
      <div style="position: absolute; top: 30px; left: 30px;">
        <a href="https://trello.com/b/NRzy3Nyi/modded-cube-combination" target="_blank" onclick="window.open(this.href, '_blank').focus()">
          <button class="trello">Trello</button>
        </a>
      </div>
      <div>
        <input autocomplete="off" id="input" name="recipes" placeholder="Search Recipe" lost="" role="combobox"/>
        <datalist role="listbox" id="recipes"></datalist>
      </div>
    </header>
    <main>
      <div class="recipes"></div>
    </main>
    <footer></footer>
    <script>
        // MAIN
        const items = [];
        String.prototype.getItem = function() {
          return items.find(i => i.name == this);
        };

        function newItem(itemName, recipe) {
          if (recipe.type == 'unknown' && itemName.getItem()) return;

          if (itemName.getItem()) {
            const recipes = itemName.getItem().recipes;
            const unknownRecipe = recipes.find(r => r.type == 'unknown');
            if (unknownRecipe) recipes.splice(recipes.indexOf(unknownRecipe), 1);
          }


          if (!itemName.getItem())
            items.push({
              name: itemName,
              recipes: [],
              output: [],
            });
          itemName.getItem().recipes.push(recipe);

          if (recipe.type != 'location' && recipe.type != 'loot') {
            if (recipe.source instanceof Array) {
              recipe.source.forEach(item => {
                if (!item.getItem())
                  items.push({
                    name: item,
                    recipes: [],
                    output: [],
                  });
                item.getItem().output.push({...recipe, result:itemName});
              });
            } else if (recipe.source) {
              if (!recipe.source.getItem())
                items.push({
                  name: recipe.source,
                  recipes: [],
                  output: [],
                });
              recipe.source.getItem().output.push({...recipe, result:itemName});
            }
          }

          if (recipe.type == 'furnace') {
            const ashRecipes = 'Ash Cube'.getItem().recipes;
            const ashRecipe = ashRecipes.find(r => r.source == recipe.source);
            if (ashRecipe) ashRecipes.splice(ashRecipes.indexOf(ashRecipe), 1);
          }

          if (itemName == '<No Item>') return;
          const ashRecipes = 'Ash Cube'.getItem().recipes;
          const ashRecipe = ashRecipes.find(r => r.source == itemName);

          const hasFurnaceRecipe = itemName.getItem().output.find(r => r.type == 'furnace');
          if (hasFurnaceRecipe) {
            if (ashRecipe) ashRecipes.splice(ashRecipes.indexOf(ashRecipe), 1);
            return;
          }

          if (ashRecipe) return;
          const recipes = 'Ash Cube'.getItem().recipes;
          const unknownRecipe = recipes.find(r => r.type == 'unknown');
          if (unknownRecipe) recipes.splice(recipes.indexOf(unknownRecipe), 1);
          ashRecipes.push({type:'furnace', source:itemName});
        }

        function unknownItem(...recipes) {
          recipes.forEach(name => newItem(
            name,
            {
              type: 'unknown',
            },
          ));
        }
        function locationItem(sourceName, ...recipes) {
          recipes.forEach(name => newItem(
            name,
            {
              type: 'location',
              source: sourceName,
            },
          ));
        }
        function lootItem(sourceName, ...recipes) {
          recipes.forEach(name => newItem(
            name,
            {
              type: 'loot',
              source: sourceName,
            },
          ));
        }
        function craftItem(recipes) {
          recipes.forEach(([name, sourceA, sourceB]) => newItem(
            name,
            {
              type: 'craft',
              source: [sourceA, sourceB],
            },
          ));
        }
        function furnaceItem(recipes) {
          recipes.forEach(([name, sourceA]) => newItem(
            name,
            {
              type: 'furnace',
              source: sourceA,
            },
          ));
        }
        function timeItem(recipes) {
          recipes.forEach(([name, sourceA]) => newItem(
            name,
            {
              type: 'time',
              source: sourceA,
            },
          ));
        }





        // RECIPES
        unknownItem('Ash Cube');
        locationItem(
          'Spawn',
          'Red Cube',
          'Green Cube',
          'Blue Cube',
          'White Cube',
          'Dirt Cube',
          'Wood Cube',
          'Rock Cube',
          'Ice Cube',
        );

        locationItem(
          'Underworld',
          'Pain Cube',
          'Crimson Cube',
          'Flesh Cube',
          'Fire',
        );

        locationItem(
          'Magic Island',
          'Magic Crystal',
        );

        lootItem(
          'Guardian Of The Underworld',
          'Enriched Pyrolite',
        );



        craftItem([
          ['Yellow Cube', 'Red Cube', 'Green Cube'],
          ['Orange Cube', 'Yellow Cube', 'Red Cube'],
          ['Lime Cube', 'Yellow Cube', 'Green Cube'],

          ['Magenta Cube', 'Red Cube', 'Blue Cube'],
          ['Purple Cube', 'Magenta Cube', 'Blue Cube'],

          ['Cyan Cube', 'Green Cube', 'Blue Cube'],
          ['Caltrop', 'Cyan Cube', 'Copper'],
          ['Flaming Caltrop', 'Caltrop', 'Lava Cube'],
          ['Glacier Caltrop', 'Caltrop', 'Glacier Cube'],
          ['Rusty Caltrop', 'Caltrop', 'Rusted Iron'],

          ['White Cube', 'Magenta Cube', 'Green Cube'],
          ['White Cube', 'Cyan Cube', 'Red Cube'],
          ['White Cube', 'Yellow Cube', 'Blue Cube'],

          ['Pack Cube', 'Wood Cube', 'Dirt Cube'],
          ['Container Cube', 'Pack Cube', 'Plate Cube'],
          ['Backpack Cube', 'Container Cube', 'Wealth Cube'],

          ['Lava Cube', 'Rock Cube', 'Molten Sphere'],
          ['Activator Cube', 'Lava Cube', 'White Cube'],
          ['Cooled Lava Cube', 'Lava Cube', 'Glacier Cube'],
          ['Power Cube', 'Cooled Lava Cube', 'Plasma Cube'],
          ['Charged Power Cube', 'Power Fragment', 'Power Cube'],
          ['Super-Charged Power Cube', 'Charged Power Cube', 'Goldplate Cube'],

          ['Permafrost Cube', 'Glacier Cube', 'Glacier Cube'],
          ['Glacier Cube', 'Ice Cube', 'Water Cube'],
          ['Sand Cube', 'Steam Cube', 'Rock Cube'],
          ['Wet Sand Cube', 'Sand Cube', 'Water Cube'],
          ['Mud Cube', 'Dirt Cube', 'Water Cube'],
          ['Soil Cube', 'Mud Cube', 'Green Cube'],
          ['Grass Cube', 'Soil Cube', 'Green Cube'],
          ['Flower Cube', 'Grass Cube', 'Magenta Cube'],
          ['Blossom Cube', 'Flower Cube', 'Enricher'],

          ['Wet Concrete Cube', 'Mud Cube', 'Wet Sand Cube'],
          ['Acid Cube', 'Water Cube', 'Plasma Cube'],
          ['Energy Cube', 'Lava Cube', 'Plasma Cube'],
          ['Light Cube', 'Energy Cube', 'Copper Cube'],

          ['Copper Cube', 'White Cube', 'Copper'],
          ['Iron Cube', 'White Cube', 'Iron'],
          ['Gold Cube', 'White Cube', 'Gold'],
          ['Pyrolite Cube', 'White Cube', 'Pyrolite'],
          ['Rusted Iron', 'Steam Cube', 'Iron'],
          ['Rusted Iron Cube', 'Steam Cube', 'Iron Cube'],
          ['Rusted Iron Cube', 'White Cube', 'Rusted Iron'],
          ['Slightly Oxidised Copper Cube', 'White Cube', 'Slightly Oxidised Copper'],
          ['Heavily Oxidised Copper Cube', 'White Cube', 'Heavily Oxidised Copper'],

          ['Air Cube', 'Steam Cube', 'White Cube'],
          ['Dash Cube', 'Air Cube', 'Cyan Cube'],

          ['Forge Cube', 'Gold Cube', 'Iron Cube'],
          ['Plate Cube', 'Forge Cube', 'Iron Cube'],
          ['Metalic Cube', 'Forge Cube', 'Plate Cube'],
          ['Pusher', 'Metalic Cube', 'Stick'],
          ['Battery Cube', 'Plate Cube', 'Acid Cube'],
          ['Charged Battery Cube', 'Battery Cube', 'Charged Power Cube'],
          ['Teleportation Pad', 'Concrete Barricade', 'Charged Battery Cube'],
          ['Wealth Cube', 'Forge Cube', 'Gold Cube'],
          ['Goldplate Cube', 'Wealth Cube', 'Plate Cube'],
          ['Enricher', 'Goldplate Cube', 'Cooled Lava Cube'],
          ['Enrichment Cube', 'Enricher', 'Wealth Cube'],
          ['Enriched Pyrolite', 'Enricher', 'Pyrolite'],
          ['Gilded Stick', 'Enrichment Cube', 'Stick'],

          ['Healer Cube', 'Plate Cube', 'Green Cube'],
          ['Life Cube', 'Healer Cube', 'Enrichment Cube'],
          ['Soul Cube', 'Life Cube', 'Power Cube'],
          ['Cruelty Cube', 'Soul Cube', 'Death Cube'],
          ['Max Health Increaser', 'Life Cube', 'Healer Cube'],
          ['Max Health Decreaser', 'Max Health Increaser', 'Death Cube'],
          ['Regen Cube', 'Healer Cube', 'Wealth Cube'],
          ['Restore Cube', 'Regen Cube', 'Enriched Green Cube'],
          ['Health Cube', 'Regen Cube', 'Healer Cube'],
          ['Regen Coil', 'Regen Cube', 'Forge Cube'],
          ['Restoration Coil', 'Regen Cube', 'Restore Cube'],

          ['Enriched Red Cube', 'Wealth Cube', 'Red Cube'],
          ['Enriched Green Cube', 'Wealth Cube', 'Green Cube'],
          ['Enriched Blue Cube', 'Wealth Cube', 'Blue Cube'],

          ['Sword', 'Forge Cube', 'Iron'],
          ['Golden Sword', 'Sword', 'Gold Cube'],
          ['Air Sword', 'Golden Sword', 'Air Cube'],
          ['Light Sword', 'Golden Sword', 'Light Cube'],
          ['Club', 'Wood Cube', 'Red Cube'],
          ['Reinforced Club', 'Club', 'Forge Cube'],
          ['Iron Club', 'Reinforced Club', 'Iron Cube'],
          ['Golden Club', 'Reinforced Club', 'Gold Cube'],
          ['Ice Club', 'Iron Club', 'Ice Cube'],
          ['Flaming Club', 'Iron Club', 'Lava Cube'],
          ['Goldfire Club', 'Flaming Club', 'Golden Club'],
          ['Glacier Club', 'Ice Club', 'Glacier Club'],
          ['Goldfire Club', 'Goldfire Club', 'Golden Club'],

          ['Concrete Barricade', 'Concrete Cube', 'Iron Cube'],
          ['Stone Barricade', 'Rock Cube', 'Iron Cube'],
          ['Wooden Barricade', 'Wood Cube', 'Iron Cube'],
          ['Metal Barricade', 'Copper Cube', 'Iron Cube'],
          ['Metal Wall', 'Metal Barricade', 'Plate Cube'],
          ['Metal Window Wall', 'Metal Wall', 'Green Cube'],
          ['Lantern', 'Wooden Barricade', 'Light Cube'],
          ['Hammer', 'Wood Cube', 'Iron'],

          ['Ally Cube', 'Wealth Cube', 'Power Cube'],
          ['Speed Coil', 'Forge Cube', 'Red Cube'],
          ['Gravity Coil', 'Forge Cube', 'Blue Cube'],
          ['Fusion Coil', 'Speed Coil', 'Gravity Coil'],
          ['Enriched Speed Coil', 'Speed Coil', 'Enriched Red Cube'],
          ['Enriched Gravity Coil', 'Gravity Coil', 'Enriched Blue Cube'],

          ['Blade', 'Forge Cube', 'Copper'],
          ['Sword', 'Blade', 'Wood Cube'],
          ['Pyrolite Sword', 'Sword', 'Pyrolite Cube'],
          ['Heavy Hammer', 'Forge Cube', 'Hammer'],

          ['Stick', 'Forge Cube', 'Wood Cube'],
          ['Ladder', 'Stick', 'Wooden Barricade'],

          ['Corruption Cube', 'Corruption', 'White Cube'],
          ['Chromium Cube', 'Chromium', 'White Cube'],
          ['Flesh Barricade', 'Chromium Cube', 'Flesh Cube'],
          ['Flesh Wall', 'Plate Cube', 'Flesh Barricade'],

          ['Chromium Ring', 'Chromium Cube', 'Chromium'],
          ['Semi-Powerful Magic Crystal', 'Magic Crystal', 'Magic Crystal'],
          ['Powerful Magic Crystal', 'Semi-Powerful Magic Crystal', 'Semi-Powerful Magic Crystal'],
          ['Mage Staff', 'Powerful Magic Crystal', 'Stick'],
          ['Charged Mage Staff', 'Mage Staff', 'Charged Power Cube'],
          ['Charged Healer Staff', 'Charged Mage Staff', 'Regen Cube'],

          ['Throwable Cube', 'Iron', 'Red Cube'],
          ['Explosive Cube', 'Throwable Cube', 'Gunpowder Cube'],
          ['Bomb Cube', 'Explosive Cube', 'Lava Cube'],
          ['Impact Cube', 'Explosive Cube', 'Enrichment Cube'],
          ['Impact Bomb Cube', 'Impact Cube', 'Bomb Cube'],

          ['??? Cube', 'Impact Bomb Cube', 'Discombobulated White Cube'],
        ]);



        furnaceItem([
          ['<No Item>', 'Ash Cube'],

          ['Glacier Cube', 'Permafrost Cube'],
          ['Ice Cube', 'Glacier Cube'],
          ['Water Cube', 'Ice Cube'],
          ['Steam Cube', 'Water Cube'],
          ['Plasma Cube', 'Steam Cube'],

          ['Copper', 'Dirt Cube'],
          ['Iron', 'Dirt Cube'],
          ['Gold', 'Dirt Cube'],

          ['Black Cube', 'White Cube'],

          ['Corruption', 'Crimson Cube'],
          ['Chromium', 'Crimson Cube'],
          ['Orb Of Crimson', 'Crimson Cube'],
          ['Death Cube', 'Pain Cube'],

          ['Molten Sphere', 'Rock Cube'],
          ['Molten Sphere', 'Copper'],
          ['Molten Sphere', 'Iron'],
          ['Molten Sphere', 'Rusted Iron'],
          ['Molten Sphere', 'Gold'],
          ['Molten Sphere', 'Pyrolite'],
          ['Molten Sphere', 'Slightly Oxidised Copper'],
          ['Molten Sphere', 'Heavily Oxidised Copper'],
          ['Molten Sphere', 'Copper Cube'],
          ['Molten Sphere', 'Iron Cube'],
          ['Molten Sphere', 'Rusted Iron Cube'],
          ['Molten Sphere', 'Gold Cube'],
          ['Molten Sphere', 'Pyrolite Cube'],
          ['Molten Sphere', 'Slightly Oxidised Copper Cube'],
          ['Molten Sphere', 'Heavily Oxidised Copper Cube'],
          ['Molten Sphere', 'Corruption'],
          ['Molten Sphere', 'Corruption Cube'],
          ['Molten Sphere', 'Chromium'],
          ['Molten Sphere', 'Chromium Cube'],

          ['Power Fragment', 'Power Cube'],
          ['Concrete Cube', 'Wet Concrete Cube'],
          ['Gunpowder Cube', 'Sand Cube'],
        ]);



        timeItem([
          ['Slightly Oxidised Copper', 'Copper'],
          ['Heavily Oxidised Copper', 'Slightly Oxidised Copper'],

          ['Slightly Oxidised Copper Cube', 'Copper Cube'],
          ['Heavily Oxidised Copper Cube', 'Slightly Oxidised Copper Cube'],
        ]);



        unknownItem();





        // RECIPE
        let dragging = null;
        const getFontSize = (textLength) => {
          const baseSize = 16;
          const fontSize = Math.max(9, baseSize - textLength * 0.25);
          return `${fontSize}px`
        };
        function changeRecipe(el) {
          el.view = !el.view;
          if (el.view) {
            el.querySelector('.body').innerHTML = `${
              el.item.output.map(r => {
                let rec;

                if (r.type == 'craft') rec = `<div class="recipeData craftRecipe">
                  <span class="slot sourceItem" title="${r.result}">${r.result}</span>
                  <span class="sign">:</span>
                  <span class="slot sourceItem" title="${r.source[0]}">${r.source[0]}</span>
                  <span class="sign">+</span>
                  <span class="slot sourceItem" title="${r.source[1]}">${r.source[1]}</span>
                </div>`;

                if (r.type == 'furnace') rec = `<div class="recipeData furnaceRecipe">
                  <span class="slot sourceItem" title="${r.result}">${r.result}</span>
                  <span class="sign">:</span>
                  <span class="slot">Furnace</span>
                  <span class="sign">+</span>
                  <span class="slot sourceItem" title="${r.source}">${r.source}</span>
                </div>`;

                if (r.type == 'time') rec = `<div class="recipeData timeRecipe">
                  <span class="slot sourceItem" title="${r.result}">${r.result}</span>
                  <span class="sign">:</span>
                  <span class="slot sourceItem">Time</span>
                </div>`;

                return `<div class="itemRecipe">${rec}</div>`
              }).join('')
            }`;
          } else {
            el.querySelector('.body').innerHTML = `${
              el.item.recipes.map(r => {
                let rec;

                if (r.type == 'location') rec = `<div class="recipeData locationRecipe">
                  <span class="recipeType location">Location</span>
                  <span class="sign">:</span>
                  <span class="slot sourceLoot">${r.source}</span>
                </div>`;

                if (r.type == 'loot') rec = `<div class="recipeData lootRecipe">
                  <span class="recipeType loot">Loot</span>
                  <span class="sign">:</span>
                  <span class="slot sourceLoot">${r.source}</span>
                </div>`;

                if (r.type == 'craft') rec = `<div class="recipeData craftRecipe">
                  <span class="recipeType craft">Craft</span>
                  <span class="sign">:</span>
                  <span class="slot sourceItem" title="${r.source[0]}">${r.source[0]}</span>
                  <span class="sign">+</span>
                  <span class="slot sourceItem" title="${r.source[1]}">${r.source[1]}</span>
                </div>`;

                if (r.type == 'furnace') rec = `<div class="recipeData furnaceRecipe">
                  <span class="recipeType furnace">Furnace</span>
                  <span class="sign">:</span>
                  <span class="slot sourceItem" title="${r.source}">${r.source}</span>
                </div>`;

                if (r.type == 'time') rec = `<div class="recipeData timeRecipe">
                  <span class="recipeType time">Time</span>
                  <span class="sign">:</span>
                  <span class="slot sourceItem" title="${r.source}">${r.source}</span>
                </div>`;

                if (r.type == 'unknown') rec = `<div class="recipeData unknownRecipe">
                  <span class="recipeType unknown">No Data</span>
                </div>`;

                return `<div class="itemRecipe">${rec}</div>`
              }).join('')
            }`;
          }
          [...el.querySelectorAll('.slot')].forEach((i) => {
            i.style.fontSize = getFontSize(i.textContent.length);
          });
          [...el.querySelectorAll('.sourceItem')].forEach((i) => {
            i.onclick = function(e) {
              openRecipe(this.title.getItem() || {name: this.title, recipes: [{type:'unknown'}]});

              e.preventDefault();
              e.cancelBubble = true;
              return false;
            };
          });
        }
        function openRecipe(item) {
          let win = document.createElement('div');
          win = document.getElementsByClassName('recipes')[0].appendChild(win);
          win.outerHTML = `<div class="recipe" id="check" style="left: ${window.outerWidth/2 - 275/2}px; top: ${document.querySelector('#input').offsetTop + 100}px;">
            <div class="head" draggable="true">
              <div class="change"><span>~</span></div>
              <div class="name"><span>${item.name}</span></div>
              <div class="close"><span>X</span></div>
            </div>
            <div class="body">
              ${
                item.recipes.map(r => {
                  let rec;

                  if (r.type == 'location') rec = `<div class="recipeData locationRecipe">
                    <span class="recipeType location">Location</span>
                    <span class="sign">:</span>
                    <span class="slot sourceLoot">${r.source}</span>
                  </div>`;

                  if (r.type == 'loot') rec = `<div class="recipeData lootRecipe">
                    <span class="recipeType loot">Loot</span>
                    <span class="sign">:</span>
                    <span class="slot sourceLoot">${r.source}</span>
                  </div>`;

                  if (r.type == 'craft') rec = `<div class="recipeData craftRecipe">
                    <span class="recipeType craft">Craft</span>
                    <span class="sign">:</span>
                    <span class="slot sourceItem" title="${r.source[0]}">${r.source[0]}</span>
                    <span class="sign">+</span>
                    <span class="slot sourceItem" title="${r.source[1]}">${r.source[1]}</span>
                  </div>`;

                  if (r.type == 'furnace') rec = `<div class="recipeData furnaceRecipe">
                    <span class="recipeType furnace">Furnace</span>
                    <span class="sign">:</span>
                    <span class="slot sourceItem" title="${r.source}">${r.source}</span>
                  </div>`;

                  if (r.type == 'time') rec = `<div class="recipeData timeRecipe">
                    <span class="recipeType time">Time</span>
                    <span class="sign">:</span>
                    <span class="slot sourceItem" title="${r.source}">${r.source}</span>
                  </div>`;

                  if (r.type == 'unknown') rec = `<div class="recipeData unknownRecipe">
                    <span class="recipeType unknown">No Data</span>
                  </div>`;

                  return `<div class="itemRecipe">${rec}</div>`
                }).join('')
              }
            </div>
          </div>`;

          const el = document.querySelector('#check');
          el.item = item;
          el.date = +new Date();
          [...document.querySelectorAll('.recipe')].sort((a,b) => a.date - b.date).forEach((el, i) => {
            el.style.zIndex = i;
          });

          [...document.querySelectorAll('.recipe')].forEach(el => {
            if (el.was) return;
            el.was = true;
            el.onclick = e => {
              el.date = +new Date();
              [...document.querySelectorAll('.recipe')].sort((a,b) => a.date - b.date).forEach((el, i) => {
                el.style.zIndex = i;
              });
            };
            el.querySelector('.head').addEventListener(`dragstart`, (e) => {
              e.preventDefault();
              el.date = +new Date();
              [...document.querySelectorAll('.recipe')].sort((a,b) => a.date - b.date).forEach((el, i) => {
                el.style.zIndex = i;
              });
              el.dx = el.offsetLeft - e.clientX;
              el.dy = el.offsetTop - e.clientY;
              dragging = el;
              return false;
            })
            el.querySelector('.head').addEventListener(`dragover`, (e) => {
              e.preventDefault();
              dragging = null;
              return false;
            });
            el.querySelector('.change').onclick = e => changeRecipe(el);
            el.querySelector('.close').onclick = e => el.remove();
            [...el.querySelectorAll('.slot')].forEach((i) => {
              i.style.fontSize = getFontSize(i.textContent.length);
            });
            [...el.querySelectorAll('.sourceItem')].forEach((i) => {
              i.onclick = function(e) {
                openRecipe(this.title.getItem() || {name: this.title, recipes: [{type:'unknown'}]});

                e.preventDefault();
                e.cancelBubble = true;
                return false;
              };
            });
          });
        }
        document.onmousemove = function(e) {
          if (!dragging) return;
          dragging.style.left = (e.clientX + dragging.dx) + 'px';
          dragging.style.top = (e.clientY + dragging.dy) + 'px';
        }
        document.onmouseup = function(e) {
          dragging = null;
        }





        // SEARCH
        items.forEach(item => {
          const opt = document.createElement('option');
          opt.innerHTML = item.name;
          opt.value = item.name;
          document.querySelector('#recipes').appendChild(opt);
        });
        input.onclick = function (e) {
          recipes.style.display = 'block';
          input.style.borderRadius = "5px 5px 0 0";

          e.preventDefault();
          e.cancelBubble = true;
          return false;
        };
        for (let option of recipes.options) {
          option.onclick = function (e) {
            input.value = '';
            recipes.style.display = 'none';
            input.style.borderRadius = "5px";

            openRecipe(option.value.getItem() || {name: option.value, recipes: [{type:'unknown'}]});

            e.preventDefault();
            e.cancelBubble = true;
            return false;
          }
        };
        document.onclick = function(e) {
          recipes.style.display = 'none';
          input.style.borderRadius = "5px";
          e.preventDefault();
          return false;
        }

        input.oninput = function() {
          currentFocus = -1;
          var text = input.value.toUpperCase();
          for (let option of recipes.options) {
            if(option.value.toUpperCase().indexOf(text) > -1){
              option.style.display = "block";
            }else{
              option.style.display = "none";
            }
          };
        }
        var currentFocus = -1;
        input.onkeydown = function(e) {
          if(e.keyCode == 40){
            currentFocus++
          addActive(recipes.options);
          }
          else if(e.keyCode == 38){
            currentFocus--
          addActive(recipes.options);
          }
          else if(e.keyCode == 13){
            e.preventDefault();
                if (currentFocus > -1) {
                  /*and simulate a click on the "active" item:*/
                  if (recipes.options) recipes.options[currentFocus].click();
                }
          }
        }

        function addActive(x) {
          if (!x) return false;
          removeActive(x);
          if (currentFocus >= x.length) currentFocus = 0;
          if (currentFocus < 0) currentFocus = (x.length - 1);
          x[currentFocus].classList.add("active");
        }
        function removeActive(x) {
          for (var i = 0; i < x.length; i++) {
            x[i].classList.remove("active");
          }
        }
    </script>
  </body>
</html>
